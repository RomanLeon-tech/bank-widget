# Bank Widget

## Цель проекта

Проект предназначен для обработки и анализа банковских операций клиента.

## Инструкции по установке
### Структура проекта:

-src/masks.py - модуль, содержащий две функции, 
создающие маску номеров карт и счетов
-src/widget.py - модуль, содержащий функцию, 
добавляющую к маскам номеров карт и счетов их наименование, 
а также функцию приведения получаемой даты в
формат вида "ДД.ММ.ГГГГ"
-src/processing.py - модуль, содержащий функции фильтрации
и сортировки получаемых списков словарей с данными 
о банковских операциях
-main.py - модуль, реализующий логику проекта

### Инструкции по установке

1. Клонируйте репозиторий:
   ```sh
   git clone https://github.com/RomanLeon-tech/bank-widget.git
2. Установите зависимости:
Для работы проекта необходимы следующие зависимости:
-Python 3.9 или выше
-Poetry (менеджер зависимостей для Python)
   ```sh
   poetry install

### Использование:

Проект "Bank - widget" содержит модули, которые 
на бэкенде будут готовить данные
по банковским операциям клиентов, 
и выполняющие следующие функции:

-маскировка номера карты;
-маскировка номера счета;
-преобразование формата даты 
проведенной банковской операции;
-фильтр проведенных операций по заданному параметру
(выполненные операции, отмененные операции и др.);
-сортировка проведенных банковских операций
по дате с возможностью указания порядка сортировки 
(по умолчанию - убывание).

### Примеры работы функций:

1.filter_by_state-
Функция filter_by_state фильтрует список словарей 
по значению ключа state.
2.sort_by_date-
Функция sort_by_date сортирует список словарей по дате.
3.mask_account_card-
Функция mask_account_card маскирует номер карты или счета
в зависимости от типа входной строки.
4.get_date-
Функция get_date преобразует строку с датой
в формате "2024-03-11T02:26:18.671407" в формат "ДД.ММ.ГГГГ".

## Тестирование

Для тестирования используется библиотека `pytest`. 
Тесты находятся в директории `tests`.

Модуль masks
1.get_mask_card_number
-Тестирование правильности маскирования номера карты.
-Проверка работы функции на различных входных форматах номеров карт, 
включая граничные случаи и нестандартные длины номеров.
-Проверка, что функция корректно обрабатывает входные строки, 
где отсутствует номер карты.

2.get_mask_account
-Тестирование правильности маскирования номера счета.
-Проверка работы функции с различными форматами и длинами номеров счетов.
-Проверка, что функция корректно обрабатывает входные данные, 
где номер счета меньше ожидаемой длины.

Модуль widget
3.mask_account_card
-Тесты для проверки, что функция корректно распознает и применяет 
нужный тип маскировки в зависимости от типа входных данных (карта или счет).
-Параметризованные тесты с разными типами карт и счетов 
для проверки универсальности функции.
-Тестирование функции на обработку некорректных входных 
данных и проверка ее устойчивости к ошибкам.

4.get_data
-Тестирование правильности преобразования даты.
-Проверка работы функции на различных входных форматах даты, 
включая граничные случаи и нестандартные строки с датами.
-Проверка, что функция корректно обрабатывает входные строки, 
где отсутствует дата.

Модуль processing
5.filter_by_state
-Тестирование фильтрации списка словарей по заданному статусу 
state
-Проверка работы функции при отсутствии словарей с указанным статусом 
state в списке.
-Параметризация тестов для различных возможных значений статуса
state
 
6.sort_by_date
-Тестирование сортировки списка словарей по датам в порядке убывания и возрастания.
-Проверка корректности сортировки при одинаковых датах.
-Тесты на работу функции с некорректными или нестандартными форматами дат.

### Запуск тестов
Для запуска тестов используйте команду:
   ```sh```
   poetry run pytest

# Модуль generators:

Модуль `generators` содержит функции для работы с массивами транзакций, 
используя генераторы для эффективной обработки данных.

Функции:
1.filter_by_currency - Фильтрует транзакции по заданной валюте.
```python
from src.generators.transactions import filter_by_currency

transactions = [
    {
        "id": 939719570,
        "state": "EXECUTED",
        "date": "2018-06-30T02:08:58.425572",
        "operationAmount": {
            "amount": "9824.07",
            "currency": {
                "name": "USD",
                "code": "USD"
            }
        },
        "description": "Перевод организации",
        "from": "Счет 75106830613657916952",
        "to": "Счет 11776614605963066702"
    },
    {
        "id": 142264268,
        "state": "EXECUTED",
        "date": "2019-04-04T23:20:05.206878",
        "operationAmount": {
            "amount": "79114.93",
            "currency": {
                "name": "USD",
                "code": "USD"
            }
        },
        "description": "Перевод со счета на счет",
        "from": "Счет 19708645243227258542",
        "to": "Счет 75651667383060284188"
    }
]

usd_transactions = filter_by_currency(transactions, "USD")
for _ in range(2):
    print(next(usd_transactions))
```
2.transaction_descriptions - Возвращает описание каждой транзакции по очереди.
```python
from src.generators.transactions import transaction_descriptions

transactions = [
    {
        "id": 939719570,
        "state": "EXECUTED",
        "date": "2018-06-30T02:08:58.425572",
        "operationAmount": {
            "amount": "9824.07",
            "currency": {
                "name": "USD",
                "code": "USD"
            }
        },
        "description": "Перевод организации",
        "from": "Счет 75106830613657916952",
        "to": "Счет 11776614605963066702"
    },
    {
        "id": 142264268,
        "state": "EXECUTED",
        "date": "2019-04-04T23:20:05.206878",
        "operationAmount": {
            "amount": "79114.93",
            "currency": {
                "name": "USD",
                "code": "USD"
            }
        },
        "description": "Перевод со счета на счет",
        "from": "Счет 19708645243227258542",
        "to": "Счет 75651667383060284188"
    }
]

descriptions = transaction_descriptions(transactions)
for _ in range(2):
    print(next(descriptions))
```
3.card_number_generator - Генерирует номера банковских карт в заданном диапазоне.
```python
from src.generators.cards import card_number_generator

for card_number in card_number_generator(1, 5):
    print(card_number)
```

## Модуль decorators
Модуль `decorators` содержит декораторы для логирования выполнения функций.
Декоратор log - Декоратор `log` автоматически логирует начало и конец выполнения функции, 
а также ее результаты или возникшие ошибки.
```python
from src.decorators.log import log

@log(filename="mylog.txt")
def my_function(x, y):
    return x + y

my_function(1, 2)
```
Ожидаемый вывод в лог-файл mylog.txt при успешном выполнении: my_function ok
Ожидаемый вывод при ошибке: my_function error: тип ошибки. Inputs: (1, 2), {}
Где тип ошибки заменяется на текст ошибки.
